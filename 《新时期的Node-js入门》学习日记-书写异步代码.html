<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">ã€Šæ–°æ—¶æœŸçš„Node.jså…¥é—¨ã€‹å­¦ä¹ æ—¥è®°-ä¹¦å†™å¼‚æ­¥ä»£ç  | 0xGeekCat</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * é‚®ç®±ä¿¡æ¯ä¹‹ç±»çš„ä¸œè¥¿å¯ä»¥å¡«åœ¨è¿™é‡Œï¼Œè¿™äº›jså˜é‡åŸºæœ¬éƒ½ä½œç”¨äºsakura-app.js
   * è¿™æ ·çš„è®¾ç½®ä»…æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨åŸºäºPHPå¼€å‘çš„ä¸»é¢˜ä¸­è®¾ç½®jså˜é‡ï¼Œæ—¢ç„¶ç§»æ¤åˆ°äº†Nodeä¸Šï¼Œæˆ‘æƒ³æˆ–è®¸å¯ä»¥ç²¾ç®€è¿™ä¸€é€»è¾‘å§
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "MĞ°ĞºÑĞ¸Ğ¼0xGeekCat";
  mashiro_option.author_name = "0xGeekCat";
  mashiro_option.site_url = "https://0xgeekcat.github.io/";
  mashiro_option.v_appId = "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz";
  mashiro_option.v_appKey = "mgOpfzbkHYqU92CV4IDlAUHQ";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/images/Konachan.com%20ls%20black_hair%20f%20toriki%20touhou.jpg,https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/images/Konachan.com-293503-ghostblade-long_hair-red_hair-sword-tagme_character-thighhighs-weapon-wlop-scaled.jpg,https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/images/Konachan.com-298784-aeolian_wlop-barefoot-black_hair-braids-ghostblade-headdress-long_hair-ponytail-wlop-scaled.jpg,https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/images/Konachan.com%20-%20227403%20black_hair%20ghostblade%20jade_(wlop)%20japanese_clothes%20kimono%20logo%20realistic%20short_hair%20tattoo%20umbrella%20wlop.jpg,https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/images/Konachan.com-281267-aeolian_wlop-black_hair-bow_weapon-close-ghostblade-green_eyes-logo-long_hair-realistic-watermark-weapon-wink-wlop-scaled.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('æœ‹å‹ï¼ŒIEæµè§ˆå™¨æœªé€‚é…å“¦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dim">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://0xgeekcat.github.io/">
          <img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>ç”¨æ¥è®°å½•æˆ‘å¤§å­¦æœ€åç”Ÿæ¶¯ç ´é‡œæ²‰èˆŸåŠ›æŒ½ç‹‚æ¾œçš„ç–¯ç‹‚å­¦ä¹ å†ç¨‹</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="https://github.com/0xGeekCat" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=1292881925@qq.com" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">MĞ°ĞºÑĞ¸Ğ¼</span>
            <span class="shironeko">0xGeekCat</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    é¦–é¡µ
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    å½’æ¡£
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          æŠ€æœ¯
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%94%9F%E6%B4%BB/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          ç”Ÿæ´»
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E8%BD%AC%E8%BD%BD/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          è½¬è½½
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    ä¹¦å•
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/%E5%B7%B2%E8%AF%BB/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          å·²è¯»
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/%E6%9C%AA%E8%AF%BB/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          æœªè¯»
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    å…³äº
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          æˆ‘ï¼Ÿ
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- å¥—åµŒç›®å½•ä½¿ç”¨ï¼ˆä¸»è¦ä¸ºäº†æ”¯æ´è¯„è®ºï¼‰-->
        
          <header class="entry-header">
            <h1 class="entry-title">ã€Šæ–°æ—¶æœŸçš„Node.jså…¥é—¨ã€‹å­¦ä¹ æ—¥è®°-ä¹¦å†™å¼‚æ­¥ä»£ç </h1>
            <p class="entry-census">0xGeekCat&nbsp;Â·&nbsp;2020-8-31&nbsp;Â·&nbsp;<span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»</p></p>

            <hr>
          </header>
        
        <div class="entry-content">
          <p>ğŸ‘‡<strong>å°è£…readFileçš„readæ–¹æ³•</strong></p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)

function read(path) {
    fs.readFile(path, function (err, data) {
        console.log(data.toString())
    })
}

read(&#39;foo.txt&#39;)
read(&#39;bar.txt&#39;)
read(&#39;baz.txt&#39;)</code></pre>
<p><img src="%E3%80%8A%E6%96%B0%E6%97%B6%E6%9C%9F%E7%9A%84Node-js%E5%85%A5%E9%97%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0-%E4%B9%A6%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81/screenshot.png" alt="screenshot"></p>
<p>è°ƒç”¨<code>read</code>æ–¹æ³•è¯»å–å¤šä¸ªæ–‡ä»¶æ¯æ¬¡è¾“å‡ºç»“æœéƒ½ä¸åŒ</p>
<p>ä½†æœ‰æ—¶éœ€è¦ä¾èµ–ä¸Šä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå‡è®¾<code>foo.txt</code>æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢æœ‰ç”¨æ¥è§£å¯†çš„<code>key</code>ï¼Œéœ€è¦æ‹¿åˆ°<code>key</code>æ‰èƒ½è§£å¯†<code>bar.txt</code>é‡Œé¢çš„æ–‡æœ¬ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¸èƒ½è¿™æ ·ä½¿ç”¨<code>read</code>æ–¹æ³•</p>
<p><strong>æš‚ä¸”ä¸è€ƒè™‘<code>readFileSync</code>çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šä½¿ç”¨åµŒå¥—çš„å›è°ƒå‡½æ•°</strong></p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)

function read(path1, path2, path3) {
    fs.readFile(path1, function (err, data) {
        console.log(data.toString())
        fs.readFile(path2, function (err, data) {
            console.log(data.toString())
            fs.readFile(path3, function (err, data) {
                console.log(data.toString())
            })
        })
    })
}

read(&#39;foo.txt&#39;, &#39;bar.txt&#39;, &#39;baz.txt&#39;)</code></pre>
<p><img src="%E3%80%8A%E6%96%B0%E6%97%B6%E6%9C%9F%E7%9A%84Node-js%E5%85%A5%E9%97%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0-%E4%B9%A6%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81/screenshot%201.png" alt="screenshot 1"></p>
<p>å°†ä¸‹ä¸€ä¸ªå¼‚æ­¥æ“ä½œæ”¾åˆ°ä¸Šä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„å›è°ƒæ–¹æ³•ä¸­ï¼Œè¿™æ ·è™½ç„¶èƒ½ä¿è¯æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œä½†å½“ä»£ç åµŒå¥—çš„å±‚æ•°å¢åŠ ï¼Œä»£ç çš„å±‚æ¬¡ç»“æ„å°±ä¼šå˜å¾—ä¸æ¸…æ™°å¹¶ä¸”éš¾ä»¥ç»´æŠ¤</p>
<p><strong>å›è°ƒåœ°ç‹±</strong><code>callback hell</code>å°±è¢«ç”¨æ¥æè¿°è¿™ç§å†™æ³•ã€‚å®ƒæœ¬èº«æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œåªæ˜¯å› ä¸ºä¸åˆ©äºå¼€å‘è€…é˜…è¯»å’Œç»´æŠ¤æ‰ä¼šé­åˆ°æ‘’å¼ƒ</p>
<h1 id="å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼"><a href="#å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼" class="headerlink" title="å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼"></a>å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼</h1><p>â“å‡è®¾ä¸€ä¸ªæ–¹æ³•å°è£…äº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œé‚£å¦‚ä½•èƒ½æ‹¿åˆ°è¿”å›å€¼</p>
<p>ç¾å¥½çš„æ„¿æœ›æ˜¯ç›´æ¥æ‹¿åˆ°å¼‚æ­¥æ–¹æ³•çš„è¿”å›å€¼</p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)

function read(path) {
    fs.readFile(path, function (err, data) {
        return data
    })
}

var data = read(&#39;foo.txt&#39;)
console.log(data) // undefined</code></pre>
<p>ç„¶è€Œç›´æ¥è°ƒç”¨<code>read</code>æ–¹æ³•ä¸ä¼šå¾—åˆ°ä»»ä½•è¿”å›å€¼ï¼Œ<code>data</code>æ‰“å°å‡ºæ¥ä¹Ÿæ˜¯<code>undefined</code></p>
<p><strong>ğŸ””åŸå› æ˜¯<code>read</code>æ–¹æ³•ä¼šå…ˆäºå†…éƒ¨çš„å›è°ƒå‡½æ•°è¿”å›ï¼Œå³å›è°ƒå‡½æ•°å†…éƒ¨çš„<code>return</code>å…³é”®å­—ä¸ä¼šå°†å€¼è¿”å›åˆ°å¤–éƒ¨</strong></p>
<h1 id="ç»„ç»‡å›è°ƒæ–¹æ³•"><a href="#ç»„ç»‡å›è°ƒæ–¹æ³•" class="headerlink" title="ç»„ç»‡å›è°ƒæ–¹æ³•"></a>ç»„ç»‡å›è°ƒæ–¹æ³•</h1><h2 id="å›è°ƒä¸CPS"><a href="#å›è°ƒä¸CPS" class="headerlink" title="å›è°ƒä¸CPS"></a>å›è°ƒä¸CPS</h2><p>å½“å¼€å‘è€…åˆšå¼€å§‹æ¥è§¦å›è°ƒæ—¶ï¼Œé€šå¸¸éƒ½ä¼šå†™æˆğŸ‘‡çš„æ ·å¼</p>
<pre><code class="javascript">function foo(args, function(err, data) {
    // todo
}) </code></pre>
<p>å¦‚æœå¯¹äºå¤šä¸ªåŠŸèƒ½ç›¸åŒçš„å¼‚æ­¥æ“ä½œï¼Œå®ƒä»¬çš„å›è°ƒå‡½æ•°éƒ½æ˜¯ç›¸åŒçš„ï¼Œè¿™æ ·çš„å†™æ³•ä¼šäº§ç”Ÿå¾ˆå¤šåŠŸèƒ½é‡å¤çš„ä»£ç </p>
<p>å¦ä¸€ç§åšæ³•æ˜¯å°†å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè¿™é€šå¸¸è¢«ç§°ä¸º<strong>å»¶ç»­ä¼ é€’æ–¹å¼</strong><code>Continuation Passing Style</code>ï¼Œ<code>CPS</code>çš„æœ¬è´¨ä»ç„¶æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°</p>
<p><strong>CPSé£æ ¼çš„å›è°ƒ</strong></p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)

var callback = function (err, data) {
    if (err) {
        console.log(err)
        return
    }
    console.log(data.toString())
}

fs.readFile(&#39;foo.txt&#39;, callback)</code></pre>
<p>å¦‚æœéœ€è¦è°ƒç”¨<code>readFile</code>æ–¹æ³•å¤šæ¬¡ï¼Œå¹¶ä¸”å®ƒä»¬çš„å›è°ƒæ–¹æ³•éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œ<code>CPS</code>å¯ä»¥çœå»ä¸€äº›é‡å¤ä»£ç </p>
<p><code>CPS</code>å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³å›è°ƒåµŒå¥—çš„é—®é¢˜</p>
<p><strong>ğŸ‘‡ä½¿ç”¨CPSæ¥å¤„ç†å¤šä¸ªå›è°ƒ</strong></p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)

function callback1 (err, data) {
    if (err) {
        console.log(err)
    } else {
        console.log(data)
        fs.readFile(&#39;bar.txt&#39;, callback2)
    }
}

function callback2 (err, data) {
    if (err) {
        console.log(err)
    } else {
        console.log(data)
        fs.readFile(&#39;baz.txt&#39;, callback3)
    }
}

function callback3 (err, data) {
    if (err) {
        console.log(err)
    } else {
        console.log(data)
    }
}

fs.readFile(&#39;foo.txt&#39;, callback1)</code></pre>
<p>è¿™æ˜¯ä¹‹å‰åµŒå¥—å›è°ƒçš„å¦ä¸€ç§å†™æ³•ï¼Œå…¶æœ¬è´¨ä¸Šä»ç„¶æ˜¯åœ¨å›è°ƒä¸­è°ƒç”¨ä¸‹ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œåªæ˜¯é¿å…äº†å¤šä¸ªå›è°ƒå‡½æ•°åœ¨å½¢å¼ä¸ŠåµŒå¥—åœ¨ä¸€èµ·</p>
<p>è™½ç„¶æ¯”åµŒå¥—è°ƒç”¨çœ‹èµ·æ¥ç¾è§‚äº†ä¸€äº›ï¼Œä½†ä»ç„¶æ˜¾å¾—å†—é•¿ï¼Œè€Œä¸”ä¸šåŠ¡é€»è¾‘åˆ†æ•£åœ¨ä¸åŒçš„<code>callback</code>ä¸­ï¼Œåˆæ¬¡æ¥è§¦ä»£ç çš„å¼€å‘è€…ä¹Ÿä¸å®¹æ˜“ç†æ¸…å®ƒä»¬ä¹‹é—´çš„å…³ç³»</p>
<h2 id="ä½¿ç”¨asyncæ¨¡å—ç®€åŒ–å›è°ƒ"><a href="#ä½¿ç”¨asyncæ¨¡å—ç®€åŒ–å›è°ƒ" class="headerlink" title="ä½¿ç”¨asyncæ¨¡å—ç®€åŒ–å›è°ƒ"></a>ä½¿ç”¨asyncæ¨¡å—ç®€åŒ–å›è°ƒ</h2><p><code>async</code>æ˜¯ä¸€ä¸ªè‘—åçš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå®ƒçš„åˆè¡·ä¹Ÿæ˜¯ä¸ºäº†è§£å†³å¤šä¸ªå¼‚æ­¥è°ƒç”¨åµŒå¥—çš„é—®é¢˜</p>
<h3 id="async-series"><a href="#async-series" class="headerlink" title="async.series"></a>async.series</h3><p><strong>ä½¿ç”¨seriesæ–¹æ³•å¤„ç†å¤šä¸ªå›è°ƒ</strong></p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)
var async = require(&#39;async&#39;)

function read_foo(callback) {
    fs.readFile(&#39;foo.txt&#39;, &#39;utf-8&#39;, callback)
}

function read_bar(callback) {
    fs.readFile(&#39;bar.txt&#39;, &#39;utf-8&#39;, callback)
}

function read_baz(callback) {
    fs.readFile(&#39;baz.txt&#39;, &#39;utf-8&#39;, callback)
}

async.series([read_foo, read_bar, read_baz], function (err, data) {
    console.log(data) // [ &#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39; ]
})</code></pre>
<p><code>series</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†å…¨éƒ¨å¼‚æ­¥æ“ä½œçš„è¿”å›ç»“æœï¼Œç»“æœé›†ä¸­çš„é¡ºåºå’Œ<code>series</code>å‚æ•°æ•°ç»„çš„é¡ºåºæ˜¯å¯¹åº”çš„</p>
<p><strong>ğŸ””è¯¥æ–¹æ³•å®é™…ä¸Šæ˜¯åµŒå¥—å›è°ƒçš„è¯­æ³•ç³–ï¼Œæ‰€æœ‰çš„å¼‚æ­¥è°ƒç”¨éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå³æ‰§è¡Œå®Œä¸€ä¸ªæ“ä½œå†è¿›è¡Œä¸‹ä¸€ä¸ªæ“ä½œ</strong></p>
<h3 id="async-parallel"><a href="#async-parallel" class="headerlink" title="async.parallel"></a>async.parallel</h3><p>è°ƒç”¨æ–¹å¼å’Œå‚æ•°éƒ½ä¸<code>series</code>ç›¸åŒï¼Œä¹Ÿä¼šé¡ºåºè¿”å›æ‰€æœ‰çš„è°ƒç”¨ç»“æœï¼ŒåŒºåˆ«åœ¨äºæ‰€æœ‰çš„æ–¹æ³•æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œ<strong>æ‰§è¡Œæ—¶é—´ç”±è€—æ—¶æœ€é•¿çš„è°ƒç”¨å†³å®š</strong></p>
<p><code>parallel</code>æ–¹æ³•åœ¨æ•°ç»„ä¸­çš„æŸä¸ªå¼‚æ­¥è°ƒç”¨ç»“æŸä¹‹åå¹¶æ²¡æœ‰ç«‹åˆ»è¿”å›ï¼Œè€Œæ˜¯å°†ç»“æœæš‚å­˜èµ·æ¥ï¼Œç­‰æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œå®Œæˆä¹‹åï¼Œ<strong>å†æ ¹æ®è°ƒç”¨é¡ºåºå°†ç»“æœç»„è£…æˆé¡ºåºçš„ç»“æœé›†è¿”å›</strong></p>
<h3 id="async-waterfall"><a href="#async-waterfall" class="headerlink" title="async.waterfall"></a>async.waterfall</h3><p>åŒæ ·æ˜¯é¡ºåºæ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œå’Œå‰ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«æ˜¯<strong>æ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œéƒ½ä¼šæŠŠç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªè°ƒç”¨</strong></p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)
var async = require(&#39;async&#39;)

function read_foo(callback) {
    fs.readFile(&#39;foo.txt&#39;, &#39;utf-8&#39;, callback)
}

function read_bar(value, callback) {
    console.log(&#39;ä¸Šä¸€ä¸ªæ“ä½œä¼ å…¥çš„å€¼&#39;, value)
    fs.readFile(&#39;bar.txt&#39;, &#39;utf-8&#39;, callback)
}

function read_baz(value, callback) {
    console.log(&#39;ä¸Šä¸€ä¸ªæ“ä½œä¼ å…¥çš„å€¼&#39;, value)
    fs.readFile(&#39;baz.txt&#39;, &#39;utf-8&#39;, callback)
}

async.waterfall([read_foo, read_bar, read_baz], function (err, data) {
    console.log(data)
})</code></pre>
<p><img src="%E3%80%8A%E6%96%B0%E6%97%B6%E6%9C%9F%E7%9A%84Node-js%E5%85%A5%E9%97%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0-%E4%B9%A6%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81/screenshot%202.png" alt="screenshot 2"></p>
<h3 id="async-map"><a href="#async-map" class="headerlink" title="async.map"></a>async.map</h3><p><code>map</code>å’Œä¸Šé¢çš„å‡ ä¸ªæ–¹æ³•ç¨æœ‰ä¸åŒï¼Œ<code>map</code>æ¥æ”¶ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œæ•°ç»„çš„å…ƒç´ ä¸æ˜¯æ–¹æ³•åè€Œæ˜¯æ–¹æ³•çš„å‚æ•°ï¼Œæ•°ç»„é‡Œçš„å€¼ä¼šä¾æ¬¡ä¼ é€’ç»™å®šä¹‰çš„å¼‚æ­¥æ–¹æ³•ï¼›<code>map</code>çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å¼‚æ­¥çš„æ–¹æ³•ï¼Œä¸éœ€è¦å†åšé¢å¤–å°è£…</p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)
var async = require(&#39;async&#39;)

var arr = [&#39;foo.txt&#39;, &#39;bar.txt&#39;, &#39;baz.txt&#39;]

async.map(arr, fs.readFile, function (err, results) {
    console.log(results.toString()) // foo,bar,baz
})</code></pre>
<p>ç„¶è€Œ<code>map</code>æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œåªèƒ½æ¥å—ä¸‰ä¸ªå‚æ•°</p>
<ul>
<li>æ•°ç»„</li>
<li>å¯¹åº”çš„å¼‚æ­¥æ–¹æ³•</li>
<li>å›è°ƒå‡½æ•°</li>
</ul>
<p>ä»¥<code>readFile</code>ä¸ºä¾‹ï¼Œä¼šå‘ç°æ²¡æœ‰å¤šä½™çš„å‚æ•°æ¥å®šä¹‰ç¼–ç æ ¼å¼ï¼Œè¿™ç§æƒ…å†µä¸‹è¿˜æ˜¯éœ€è¦å¯¹<code>readFile</code>åšä¸€å±‚å°è£…</p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)
var async = require(&#39;async&#39;)

function myReadFile(path, callback) {
    fs.readFile(path, &#39;utf-8&#39;, callback)
}

var arr = [&#39;foo.txt&#39;, &#39;bar.txt&#39;, &#39;baz.txt&#39;]

async.map(arr, myReadFile, function (err, results) {
    console.log(results.toString())
})</code></pre>
<p><code>async</code>æ¨¡å—ä¸€åº¦æ˜¯ç®¡ç†å¼‚æ­¥è°ƒç”¨çš„é¦–é€‰ï¼Œç„¶è€Œå®ƒå¹¶ä¸é€‚ç”¨æ‰€æœ‰çš„åœºåˆ</p>
<p><strong><code>async</code>é€šå¸¸ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥åŒ…å«æ‰€æœ‰çš„å¼‚æ­¥æ–¹æ³•æˆ–è€…è°ƒç”¨çš„å‚æ•°ï¼Œç„¶è€Œæœ‰æ—¶æ— æ³•åœ¨è°ƒç”¨å‰å°±å†³å®šå“ªäº›å¼‚æ­¥æ–¹æ³•ä¼šè¢«è°ƒç”¨</strong></p>
<h1 id="ä½¿ç”¨Promise"><a href="#ä½¿ç”¨Promise" class="headerlink" title="ä½¿ç”¨Promise"></a>ä½¿ç”¨Promise</h1><p>åœ¨Nodeä¸­ç‡å…ˆå¾—åˆ°å¹¿æ³›åº”ç”¨çš„æ˜¯<code>async</code>è¿™æ ·çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œasyncæ¨¡å—ä¸­æ²¡æœ‰åº”ç”¨ä»€ä¹ˆæ–°æ¦‚å¿µï¼Œåªæ˜¯å½¢å¼ä¸Šç®€åŒ–çš„è¯­æ³•ç³–ã€‚ç¤¾åŒºè‡ªç„¶ä¸ä¼šæ»¡è¶³æ­¢æ­¥äºæ­¤ï¼Œå¼€å‘è€…ä»¬æŠŠç›®å…‰æŠ•å‘äº†åˆ«å¤„ï¼Œå¸Œæœ›æœ‰ä¸€ç§æ–°çš„æ–¹å¼æ¥è§£å†³é—®é¢˜ï¼Œåœ¨è¿™ç§ç¯å¢ƒä¸‹<code>Promise</code>è¿›å…¥äº†è§†é‡</p>
<h2 id="Promiseçš„å†å²"><a href="#Promiseçš„å†å²" class="headerlink" title="Promiseçš„å†å²"></a>Promiseçš„å†å²</h2><p><code>Promise</code>æ¦‚å¿µæœ€æ—©å¯ä»¥è¿½æº¯åˆ°1976å¹´ï¼Œfutureã€promiseã€delayã€deferredè¿™å‡ ä¸ªè¯ç»å¸¸æ”¾åœ¨ä¸€å—è®¨è®ºï¼Œå®ƒä»¬éƒ½ç”¨æ¥æŒ‡ä»£ä¸€ä¸ªå¼€å§‹æ—¶çŠ¶æ€æœªçŸ¥çš„å¯¹è±¡</p>
<p>jQueryåœ¨1.5åŠä¹‹åçš„ç‰ˆæœ¬ä¸­å¢åŠ äº†<code>deferred</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯<code>Promise</code>çš„ä¸€ç§å®ç°ï¼Œå¹¶ä¸”éšç€jQueryæœ¬èº«æµè¡Œèµ·æ¥</p>
<p><strong>ğŸ‘‡æ™®é€šçš„Ajaxæ“ä½œ</strong></p>
<pre><code class="javascript">$.ajax({
   url: &quot;test.html&quot;,
   success: function () {
       alert(&#39;success&#39;)
   },
   error: function () {
       alert(&#39;fail&#39;)
   }
})</code></pre>
<p><code>success</code>å’Œ<code>fail</code>æ–¹æ³•éƒ½æ˜¯ä½œä¸ºå‚æ•°çš„ä¸€éƒ¨åˆ†ä¼ é€’ç»™<code>$.ajax()</code>æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯Ajaxæ‰§è¡Œå®Œæˆåçš„å›è°ƒå‡½æ•°</p>
<p>ğŸ‘‡ä½¿ç”¨<code>deferred</code>æ”¹å†™Ajax</p>
<pre><code class="javascript">$.ajax(&quot;test.html&quot;)
    .done(function (data) {
        alert(&#39;success&#39;)
    })
    .fail(function () {
        alert(&#39;fail&#39;)
    })</code></pre>
<p>ğŸ‘†ä¸¤æ®µä»£ç ç»“æ„ä¸Šæœ€å¤§çš„åŒºåˆ«æ˜¯ä½¿ç”¨<code>deferred</code>æ”¹å†™çš„<code>Ajax</code>æ–¹æ³•ï¼Œå°†<code>success</code>å’Œ<code>error</code>ä¸¤ä¸ªå›è°ƒå‡½æ•°ä»<code>$.ajax()</code>æ–¹æ³•ä¸­å‰¥ç¦»ï¼Œè€Œä¸”é“¾å¼è°ƒç”¨ä¹Ÿè¡¨æ˜<code>$.ajax(&quot;test.html&quot;)</code>å¼‚æ­¥æ–¹æ³•äº§ç”Ÿäº†è¿”å›å€¼ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¿›æ­¥ï¼Œç¦»æœ€å¼€å§‹çš„ç†æƒ³æ›´è¿‘ä¸€æ­¥</p>
<p>åé¢<code>Promise</code>æ¦‚å¿µå¾—åˆ°æ¨å¹¿å¹¶å‡ºäº†ä¸€äº›è§„èŒƒï¼Œä»¥<code>Promise/A+</code>æœ€ä¸ºå‡ºåï¼Œç¤¾åŒºä¹Ÿå‡ºç°äº†ä¸€äº›æ”¯æŒ<code>Promise</code>çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåæ¥<code>Promise/A+</code>æ ‡å‡†è¢«ç¤¾åŒºæ¥å—ï¼Œ<code>ES2015</code>ä¸­çš„<code>Promise</code>å°±æ˜¯æŒ‰ç…§å®ƒæ¥å®ç°çš„</p>
<h2 id="Promiseæ˜¯ä»€ä¹ˆ"><a href="#Promiseæ˜¯ä»€ä¹ˆ" class="headerlink" title="Promiseæ˜¯ä»€ä¹ˆ"></a>Promiseæ˜¯ä»€ä¹ˆ</h2><p><code>Promise</code>è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆç»“æœã€‚è¿™ä¸å¤ªå®¹æ˜“ç†è§£ï¼Œå¯ä»¥å°†<code>Promise</code>ç†è§£ä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼Œå®ƒå­˜åœ¨ä¸‹é¢ä¸‰ç§ä¸åŒçš„çŠ¶æ€ï¼Œå¹¶åœ¨æŸä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ç§çŠ¶æ€</p>
<ul>
<li>Pendingï¼šè¡¨ç¤ºè¿˜åœ¨æ‰§è¡Œ</li>
<li>Fulfilledæˆ–è€…Resolvedï¼šæ‰§è¡ŒæˆåŠŸ</li>
<li>Rejectedï¼šæ‰§è¡Œå¤±è´¥</li>
</ul>
<p>ä¸€ä¸ªPromiseæ˜¯å¯¹ä¸€ä¸ªæ“ä½œï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„å°è£…ï¼Œå¼‚æ­¥æ“ä½œæœ‰ç­‰å¾…å®Œæˆã€æˆåŠŸã€å¤±è´¥ä¸‰ç§å¯èƒ½ç»“æœï¼Œå¯¹åº”äº†Promiseçš„ä¸‰ç§çŠ¶æ€</p>
<p>Promiseçš„çŠ¶æ€åªèƒ½ç”±<code>Pendingè½¬æ¢ä¸ºResolved</code>æˆ–è€…ç”±<code>Pendingè½¬æ¢ä¸ºRejected</code>ï¼Œä¸€æ—¦çŠ¶æ€è½¬æ¢å®Œæˆå°±æ— æ³•å†æ”¹å˜</p>
<p>å‡è®¾ç”¨Promiseå°è£…ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œé‚£ä¹ˆå½“å®ƒè¢«åˆ›å»ºçš„æ—¶å€™å°±å¤„äºPendingçŠ¶æ€ï¼Œå½“å¼‚æ­¥æ“ä½œæˆåŠŸå®Œæˆæ—¶ï¼Œå°†çŠ¶æ€è½¬æ¢ä¸ºFulfilledï¼›å¦‚æœæ‰§è¡Œä¸­å‡ºç°é”™è¯¯ï¼Œå°†çŠ¶æ€è½¬æ¢ä¸ºRejected</p>
<h2 id="ES2015ä¸­çš„Promise"><a href="#ES2015ä¸­çš„Promise" class="headerlink" title="ES2015ä¸­çš„Promise"></a>ES2015ä¸­çš„Promise</h2><p><strong><code>Promise</code>å’Œ<code>Class</code>å ªç§°ES2015çš„ä¸¤ä¸ªæœ€é‡è¦çš„ç‰¹æ€§</strong>ï¼Œåœ¨å¦‚ä½•ç»„ç»‡å¼‚æ­¥ä»£ç è¿™ä¸ªé—®é¢˜ä¸Šï¼ŒES2015ä¸­çš„Generatoræˆ–è€…ES2017çš„asyncæ–¹æ³•ï¼Œéƒ½æ˜¯ä»¥Promiseä½œä¸ºåŸºç¡€çš„</p>
<h3 id="å°†å¼‚æ­¥æ–¹æ³•å°è£…æˆPromise"><a href="#å°†å¼‚æ­¥æ–¹æ³•å°è£…æˆPromise" class="headerlink" title="å°†å¼‚æ­¥æ–¹æ³•å°è£…æˆPromise"></a>å°†å¼‚æ­¥æ–¹æ³•å°è£…æˆPromise</h3><p>å¯ä»¥ç”¨Promiseçš„æ„é€ å‡½æ•°æ¥å°è£…ä¸€ä¸ªç°æœ‰çš„å¼‚æ­¥æ“ä½œ</p>
<p><strong>ğŸ‘‡Promiseçš„æ„é€ å‡½æ•°</strong></p>
<pre><code class="javascript">var promise = new Promise(function (resolve, reject) {
    // some code

    if (/*å¼‚æ­¥æ“ä½œæˆåŠŸ*/) {
        resolve(value)
    } else {
        reject(error)
    }
})</code></pre>
<p><strong>ä½¿ç”¨Promiseå°è£…çš„readFile</strong></p>
<pre><code class="javascript">var fs = require(&#39;fs&#39;)

function readFile_promise(path) {
    return new Promise(function (resolve, reject) {
        fs.readFile(path, &#39;utf-8&#39;, function (error, data) {
            if (data) {
                resolve(data)
            } else {
                reject(error)
            }
        })
    })
}</code></pre>
<p>å°†ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•å°è£…æˆPromiseå…¶å®å¾ˆç®€å•ï¼Œåªè¦åœ¨å›è°ƒå‡½æ•°ä¸­é’ˆå¯¹ä¸åŒçš„è¿”å›ç»“æœè°ƒç”¨resolveæˆ–è€…rejectæ–¹æ³•å³å¯</p>
<ul>
<li>resolveå‡½æ•°ä¼šåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸå®Œæˆæ—¶è¢«è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å¤–éƒ¨</li>
<li>rejectåˆ™æ˜¯åœ¨å¼‚æ­¥æ“ä½œå‡ºç°å¼‚å¸¸æ—¶è¢«è°ƒç”¨ï¼Œä¼šå°†é”™è¯¯ä¿¡æ¯ä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»</li>
</ul>
<p>åˆšåˆšæ¥è§¦Promiseæ¦‚å¿µçš„å¼€å‘è€…å¯èƒ½ä¼šå¯¹è¿™ä¸¤ä¸ªæ–¹æ³•æ„Ÿåˆ°å›°æƒ‘ï¼Œç®€å•åœ°è¯´ï¼Œä¸€ä¸ªå°è£…äº†å¼‚æ­¥æ“ä½œçš„Promiseå¯¹è±¡å®é™…ä¸Šå¹¶æ²¡æœ‰åšä»»ä½•äº‹æƒ…ï¼Œå®ƒä»…ä»…é’ˆå¯¹å›è°ƒå‡½æ•°çš„ä¸åŒç»“æœå®šä¹‰äº†ä¸åŒçš„çŠ¶æ€</p>
<p>resolveæ–¹æ³•å’Œrejectæ–¹æ³•æ²¡æœ‰åšå¤šä½™çš„æ“ä½œï¼Œä»…ä»…æ˜¯æŠŠå¼‚æ­¥çš„ç»“æœä¼ é€’å‡ºå»ï¼Œ<strong>å¯¹äºå¼‚æ­¥ç»“æœçš„å¤„ç†ï¼Œæ˜¯äº¤ç»™<code>then</code>æ–¹æ³•æ¥å®Œæˆçš„</strong></p>
<h3 id="ä½¿ç”¨thenæ–¹æ³•è·å–ç»“æœ"><a href="#ä½¿ç”¨thenæ–¹æ³•è·å–ç»“æœ" class="headerlink" title="ä½¿ç”¨thenæ–¹æ³•è·å–ç»“æœ"></a>ä½¿ç”¨thenæ–¹æ³•è·å–ç»“æœ</h3><p>åœ¨å°è£…å¥½Promiseå¯¹è±¡åï¼Œå°±å¯ä»¥è°ƒç”¨<code>then</code>æ–¹æ³•æ¥è·å–å¼‚æ­¥æ“ä½œçš„å€¼</p>
<pre><code class="javascript">process.then(function (value) {
    // success
}, function (error) {
    // failure
})</code></pre>
<p><code>then</code>æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªåŒ¿åå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå®ƒä»¬ä»£è¡¨<code>onResolved</code>å’Œ<code>onRejected</code>å‡½æ•°</p>
<p><code>value</code>å’Œ<code>error</code>å‚æ•°ä»£è¡¨å›è°ƒçš„ç»“æœï¼Œä»¥readFileä¸ºä¾‹ï¼Œ<code>value</code>å°±æ˜¯æ‰§è¡ŒæˆåŠŸæ—¶æ–‡æœ¬å†…å®¹ï¼Œ<code>error</code>åˆ™æ˜¯æ‰§è¡Œå‡ºé”™æ—¶çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸¤è€…ä¸­å¿…æœ‰ä¸€ä¸ªä¸ä¸ºç©º</p>
<p><strong>é€šå¸¸å¦‚æœ<code>onRejected</code>çš„å›è°ƒæ–¹æ³•è¢«è°ƒç”¨å°±è¡¨ç¤ºå¼‚æ­¥è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œæ˜¯ä½¿ç”¨<code>catch</code>æ–¹æ³•è€Œä¸æ˜¯å›è°ƒå‡½æ•°æ¥å¤„ç†å¼‚å¸¸</strong></p>
<pre><code class="javascript">promise
    .then(function (data) {
        // success
    })
    .catch(function (err) {
        // error
    })</code></pre>
<h3 id="thenæ–¹æ³•çš„è¿”å›å€¼"><a href="#thenæ–¹æ³•çš„è¿”å›å€¼" class="headerlink" title="thenæ–¹æ³•çš„è¿”å›å€¼"></a>thenæ–¹æ³•çš„è¿”å›å€¼</h3><p>thenæ–¹æ³•æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼Œè¿™ä¹Ÿå°±è¡¨ç¤ºå¯¹äºä¸€ä¸ªPromiseå¯ä»¥å¤šæ¬¡è°ƒç”¨å®ƒçš„thenæ–¹æ³•ï¼Œä½†ç”±äº<strong>é»˜è®¤è¿”å›çš„Promiseæ˜¯ä¸€ä¸ªç©ºçš„å¯¹è±¡</strong>ï¼Œé™¤éåšä¸€äº›é¢å¤–çš„æ“ä½œï¼Œå¦åˆ™è¿™ä¸€æ“ä½œé€šå¸¸å¾—ä¸åˆ°æœ‰æ„ä¹‰çš„å€¼</p>
<pre><code class="javascript">var promise = readFile_promise(&#39;foo.txt&#39;)

promise.then(function (value) {
    console.log(value) // foo
}).then(function (value) { ğŸ‘ˆ æ­¤æ—¶ç›¸å½“äº{}.then() 
    console.log(value) // undefined
})</code></pre>
<p>å¼€å‘è€…ä¹Ÿå¯ä»¥åœ¨å›è°ƒå‡½æ•°å®šä¹‰ä¸€ä¸ªæ–°çš„Promiseï¼Œç„¶åä½¿ç”¨returnæ¥è¿”å›</p>
<pre><code class="javascript">var promise = readFile_promise(&#39;foo.txt&#39;)

promise.then(function (value) {
    console.log(value) // foo
    return readFile_promise(&#39;bar.txt&#39;)
}).then(function (value) {
    console.log(value) // bar
})</code></pre>
<p>ğŸ‘†ç¬¬ä¸€ä¸ª<code>then</code>æ–¹æ³•ä¸­ï¼Œå†æ¬¡è°ƒç”¨<code>readFile_promise</code>ï¼Œå…¶è¿”å›çš„æ–°çš„Promiseè¦†ç›–äº†é»˜è®¤è¿”å›çš„Promiseç©ºå¯¹è±¡ï¼Œæˆ‘ä»¬å› æ­¤å¯ä»¥åœ¨ä¸‹ä¸€ä¸ª<code>then</code>æ–¹æ³•ä¸­è·å–å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æ‰§è¡Œç»“æœ</p>
<h3 id="Promiseçš„æ‰§è¡Œ"><a href="#Promiseçš„æ‰§è¡Œ" class="headerlink" title="Promiseçš„æ‰§è¡Œ"></a>Promiseçš„æ‰§è¡Œ</h3><p>â“è™½ç„¶æ˜¯é€šè¿‡<code>then</code>æ–¹æ³•æ¥è·å–Promiseçš„ç»“æœï¼Œä½†Promiseæ˜¯ä¸æ˜¯å½“<code>then</code>æ–¹æ³•è°ƒç”¨ä¹‹åæ‰ä¼šæ‰§è¡Œ</p>
<pre><code class="javascript">var promise = new Promise((resolve, reject) =&gt; {
    console.log(&#39;begin&#39;)
    resolve()
})

setTimeout(() =&gt; {
    promise.then(() =&gt; {
        console.log(&#39;end&#39;)
    })
}, 1000)</code></pre>
<p>å®é™…è¿è¡Œå°±ä¼šå‘ç°ï¼Œç¨‹åºç«‹åˆ»æ‰“å°å‡ºbeginï¼Œç„¶åç­‰å¾…1ç§’ï¼Œéšåå†æ‰“å°å‡ºend</p>
<p><strong>Promiseä»è¢«åˆ›å»ºçš„é‚£ä¸€åˆ»èµ·å°±å¼€å§‹æ‰§è¡Œï¼Œthenæ–¹æ³•åªæ˜¯æä¾›äº†è®¿é—®PromiseçŠ¶æ€çš„æ¥å£ï¼Œä¸Promiseçš„æ‰§è¡Œæ— å…³</strong></p>
<h2 id="Promiseçš„å¸¸ç”¨API"><a href="#Promiseçš„å¸¸ç”¨API" class="headerlink" title="Promiseçš„å¸¸ç”¨API"></a>Promiseçš„å¸¸ç”¨API</h2><h3 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve"></a>Promise.resolve</h3><p>Promiseæä¾›<code>resolve</code>æ–¹æ³•ç”¨æ¥å°†éPromiseå¯¹è±¡è½¬åŒ–ä¸ºPromiseå¯¹è±¡</p>
<p>åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸»åŠ¨è°ƒç”¨<code>resolve</code>æ–¹æ³•çš„åœºæ™¯å¹¶ä¸å¤šï¼Œå› ä¸ºè¯¥æ–¹æ³•èƒ½è½¬æ¢çš„é€šå¸¸åªæœ‰<code>thenable</code>å¯¹è±¡å’Œä¸€äº›åŸå§‹ç±»å‹çš„å¯¹è±¡</p>
<p><strong><code>thenable</code>å¯¹è±¡æ˜¯æŒ‡æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œä¸€ä¸ªå¸¸è§çš„ä¾‹å­å°±æ˜¯jQueryä¸­çš„<code>deferred</code>å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„å¯¹è±¡</strong></p>
<p>å…¶è¢«è½¬æ¢æˆPromiseåï¼Œè½¬æ¢åçš„Promiseä¼šè‡ªåŠ¨æ‰§è¡Œå…¶<code>then</code>æ–¹æ³•</p>
<pre><code class="javascript">var obj = {
    then: () =&gt; {
        console.log(&#39;I am a then method&#39;)
    }
}

Promise.resolve(obj) // I am a then method</code></pre>
<p>å¦‚æœè½¬æ¢çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¸¸é‡æˆ–è€…ä¸å…·å¤‡çŠ¶æ€çš„è¯­å¥ï¼Œè½¬æ¢åçš„å¯¹è±¡è‡ªåŠ¨å¤„äº<code>resolve</code>çŠ¶æ€ï¼Œè½¬æ¢çš„å¯¹è±¡ä½œä¸º<code>resolved</code>çš„ç»“æœåŸå°ä¸åŠ¨åœ°ä¿ç•™</p>
<pre><code class="javascript">var p = Promise.resolve(&#39;0xGeekCat&#39;)

p.then(function (result) {
    console.log(result) // 0xGeekCat
})</code></pre>
<p><code>resolve</code>å¹¶ä¸èƒ½ç”¨æ¥è½¬æ¢ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•</p>
<p><img src="%E3%80%8A%E6%96%B0%E6%97%B6%E6%9C%9F%E7%9A%84Node-js%E5%85%A5%E9%97%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0-%E4%B9%A6%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81/screenshot%203.png" alt="screenshot 3"></p>
<p>è¦è½¬æ¢å¼‚æ­¥æ–¹æ³•ï¼Œè¦ä¹ˆæ‰‹åŠ¨å°è£…ä¸€ä¸ªPromiseï¼Œè¦ä¹ˆå°±ä½¿ç”¨ä¸€äº›ç°æˆçš„æ–¹æ³•æˆ–è€…æ¨¡å—æ¥æ“ä½œ</p>
<h3 id="promise-reject"><a href="#promise-reject" class="headerlink" title="promise.reject"></a>promise.reject</h3><p><code>promise.reject</code>åŒæ ·è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œä¸åŒä¹‹å¤„åœ¨äºè¿™ä¸ªPromiseçš„çŠ¶æ€ä¸º<code>reject</code>ï¼Œ<code>reject</code>æ–¹æ³•çš„å‚æ•°ä¼šä½œä¸ºé”™è¯¯ä¿¡æ¯ä¼ é€’ç»™<code>then</code>æ–¹æ³•</p>
<p><img src="%E3%80%8A%E6%96%B0%E6%97%B6%E6%9C%9F%E7%9A%84Node-js%E5%85%A5%E9%97%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0-%E4%B9%A6%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81/screenshot%204.png" alt="screenshot 4"></p>
<p>çœ‹åˆ°æ§åˆ¶å°çš„warningä¿¡æ¯ï¼Œè¡¨æ˜<code>reject</code>çŠ¶æ€çš„Promiseæœ‰å¯èƒ½ç­‰åŒäº<code>error</code>è€Œä½¿è¿›ç¨‹é€€å‡º</p>
<p>åœ¨ä½¿ç”¨Promiseæ—¶æœ€å¥½åŠ ä¸Š<code>catch</code>æ¥æ•è·è¿™ä¸ªå¼‚å¸¸</p>
<pre><code class="javascript">var promise = readFile_promise(&#39;foo.txt&#39;)

promise.then(function (value) {
    console.log(value)
}).catch(function (err) {
    console.log(&#39;error occurred&#39;, err)
})</code></pre>
<h3 id="promise-all"><a href="#promise-all" class="headerlink" title="promise.all"></a>promise.all</h3><p>å¦‚æœæœ‰å¤šä¸ªPromiseéœ€è¦æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨<code>promise.all</code>æ–¹æ³•ç»Ÿä¸€å£°æ˜ï¼Œ<strong>è¯¥æ–¹æ³•å°†å¤šä¸ªPromiseå¯¹è±¡åŒ…è£…æˆä¸€ä¸ªPromise</strong></p>
<p>è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œæ•°æ®çš„å…ƒç´ å¦‚æœä¸æ˜¯Promiseå¯¹è±¡ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨resolveæ–¹æ³•è½¬æ¢</p>
<p>åªæœ‰æ•°ç»„ä¸­çš„Promiseçš„çŠ¶æ€å…¨éƒ¨å˜æˆ<code>resolved</code>ä¹‹åï¼Œ<code>all</code>æ–¹æ³•ç”ŸæˆPromiseçš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>resolved</code>ï¼›å¦‚æœä¸­é—´æœ‰ä¸€ä¸ªPromiseçŠ¶æ€ä¸º<code>reject</code>ï¼Œé‚£ä¹ˆè½¬æ¢åçš„Promiseä¹Ÿä¼šå˜æˆ<code>reject</code>ï¼Œå¹¶ä¸”å°†é”™è¯¯ä¿¡æ¯ä¼ ç»™<code>catch</code>æ–¹æ³•</p>
<pre><code class="javascript">var promises = [&#39;foo.txt&#39;, &#39;bar.txt&#39;, &#39;baz.txt&#39;].map(function (path) {
    return readFile_promise(path)
})

Promise.all(promises).then(function (results) {
    console.log(results) // [ &#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39; ]
}).catch(function (err) {
    console.log(&#39;error occurred&#39;, err)
})</code></pre>
<p>ä½¿ç”¨<code>promise.all</code>æ–¹æ³•å°è£…çš„Promiseï¼Œå¦‚æœå°†ç»“æœé›†æ‰“å°å‡ºæ¥ï¼Œä¼šå‘ç°å®ƒä»¬æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ—çš„</p>
<p><strong>â“æ—¢ç„¶<code>promise.all</code>ä¼šæŒ‰ç…§é¡ºåºè¿”å›å°è£…Promiseçš„ç»“æœï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä»£è¡¨å†…éƒ¨çš„Promiseæ˜¯é¡ºåºæ‰§è¡Œçš„</strong></p>
<p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå‰é¢å·²ç»æåˆ°ä¸€ä¸ªPromiseçš„æ‰§è¡Œæ˜¯ä»è¢«åˆ›å»ºçš„é‚£ä¸€åˆ»å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“è°ƒç”¨<code>promise.all</code>æ—¶ï¼Œæ‰€æœ‰çš„Promiseéƒ½å·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼Œ**<code>all</code>æ–¹æ³•åªæ˜¯ç­‰åˆ°å…¨éƒ¨çš„Promiseå®Œæˆåï¼Œå¯¹æ‰€æœ‰çš„æ‰§è¡Œç»“æœåšåŒ…è£…å†è¿”å›**</p>
<h3 id="promise-race"><a href="#promise-race" class="headerlink" title="promise.race"></a>promise.race</h3><h3 id="promise-catch"><a href="#promise-catch" class="headerlink" title="promise.catch"></a>promise.catch</h3><h2 id="ä½¿ç”¨Promiseç»„ç»‡å¼‚æ­¥ä»£ç "><a href="#ä½¿ç”¨Promiseç»„ç»‡å¼‚æ­¥ä»£ç " class="headerlink" title="ä½¿ç”¨Promiseç»„ç»‡å¼‚æ­¥ä»£ç "></a>ä½¿ç”¨Promiseç»„ç»‡å¼‚æ­¥ä»£ç </h2><h2 id="ç¬¬ä¸‰æ–¹æ¨¡å—çš„Promise"><a href="#ç¬¬ä¸‰æ–¹æ¨¡å—çš„Promise" class="headerlink" title="ç¬¬ä¸‰æ–¹æ¨¡å—çš„Promise"></a>ç¬¬ä¸‰æ–¹æ¨¡å—çš„Promise</h2><h1 id="Generatorï¼Œä¸€ç§è¿‡æ¸¡æ–¹æ¡ˆ"><a href="#Generatorï¼Œä¸€ç§è¿‡æ¸¡æ–¹æ¡ˆ" class="headerlink" title="Generatorï¼Œä¸€ç§è¿‡æ¸¡æ–¹æ¡ˆ"></a>Generatorï¼Œä¸€ç§è¿‡æ¸¡æ–¹æ¡ˆ</h1><h1 id="å›è°ƒçš„ç»ˆç‚¹â€”â€”async-await"><a href="#å›è°ƒçš„ç»ˆç‚¹â€”â€”async-await" class="headerlink" title="å›è°ƒçš„ç»ˆç‚¹â€”â€”async/await"></a>å›è°ƒçš„ç»ˆç‚¹â€”â€”async/await</h1>
        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">èµ
            <div class="reward-main">
              <ul class="reward-row">
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/photos/wechat.png"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
        
          
            <div class="post-nepre full next">
          
            <a href="/%E3%80%8A%E6%96%B0%E6%97%B6%E6%9C%9F%E7%9A%84Node-js%E5%85%A5%E9%97%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0-%E7%94%A8ES6%E4%B9%A6%E5%86%99Node.html" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.1/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                ã€Šæ–°æ—¶æœŸçš„Node.jså…¥é—¨ã€‹å­¦ä¹ æ—¥è®°-ç”¨ES6ä¹¦å†™Node</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz",
        appKey: "mgOpfzbkHYqU92CV4IDlAUHQ",
        path: window.location.pathname,
        placeholder: "ä½ æ˜¯æˆ‘ä¸€ç”Ÿåªä¼šé‡è§ä¸€æ¬¡çš„æƒŠå–œ ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="https://0xgeekcat.github.io/" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/img/custom/avatar.jpg" itemprop="image" alt="0xGeekCat" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="https://0xgeekcat.github.io/" itemprop="url" rel="author">0xGeekCat</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="è¯·è¾“å…¥å…³é”®è¯..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            // PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 0xGeekCat<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- ä¸è’œå­ ç½‘é¡µè®¡æ•°å™¨ -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.1","name":"/video/The-Pet-Girl-of-Sakurasou.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.1","name":"/video/The-Pet-Girl-of-Sakurasou.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //æœ‰å›¾çš„æƒ…å†µ
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // æ”¾ç½®ç›®å½•çš„å®¹å™¨
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // æ­£æ–‡å†…å®¹æ‰€åœ¨
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // éœ€è¦ç´¢å¼•çš„æ ‡é¢˜çº§åˆ«
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // æ”¾ç½®ç›®å½•çš„å®¹å™¨
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // æ­£æ–‡å†…å®¹æ‰€åœ¨
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // éœ€è¦ç´¢å¼•çš„æ ‡é¢˜çº§åˆ«
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <!-- å®ç°æ¢è‚¤åŠŸèƒ½ -->

  <div class="skin-menu no-select" id="mainskin" style="position: fixed">
 <div class="theme-controls row-container">
  <ul class="menu-list">
   <li id="white-bg"> <i class="fa fa-television" aria-hidden="true"></i></li>
   <li id="sakura-bg"> <i class="iconfont icon-sakura"></i></li>
   <li id="gribs-bg"> <i class="fa fa-slack" aria-hidden="true"></i></li>
   <li id="KAdots-bg"> <i class="iconfont icon-dots"></i></li>
   <li id="totem-bg"> <i class="fa fa-optin-monster" aria-hidden="true"></i></li>
   <li id="pixiv-bg"> <i class="iconfont icon-pixiv"></i></li>
   <li id="bing-bg"> <i class="iconfont icon-bing"></i></li>
   <li id="dark-bg"> <i class="fa fa-moon-o" aria-hidden="true"></i></li>
  </ul>
 </div>
</div>
<canvas id="night-mode-cover"></canvas>

  <div class="changeSkin-gear no-select">

  <div class="keys" id="setbtn"> 

   <span id="open-skinMenu"> åˆ‡æ¢ä¸»é¢˜ | SCHEME TOOL  

     <i class="iconfont icon-gear inline-block rotating"></i> 

   </span>

  </div>

</div>

  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/0xGeekCat/cdn@2.2/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">MĞ°ĞºÑĞ¸Ğ¼0xGeekCat</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="https://github.com/0xGeekCat" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            é¦–é¡µ
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            å½’æ¡£
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E6%8A%80%E6%9C%AF/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  æŠ€æœ¯
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%94%9F%E6%B4%BB/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  ç”Ÿæ´»
                </a>
              </li>
            
              <li>
                <a href="/categories/%E8%BD%AC%E8%BD%BD/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  è½¬è½½
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            ä¹¦å•
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/%E5%B7%B2%E8%AF%BB/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  å·²è¯»
                </a>
              </li>
            
              <li>
                <a href="/tags/%E6%9C%AA%E8%AF%BB/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  æœªè¯»
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            å…³äº
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  æˆ‘ï¼Ÿ
                </a>
              </li>
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>